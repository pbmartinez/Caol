@using Application.Dtos
@using Domain.Localization
@using Microsoft.Extensions.Localization
@inject HttpClient Http
@inject IStringLocalizer<Resource> Localizer


<h3>Pie Chart</h3>

<MudPaper Class="pa-4">
    <MudChart ChartType="ChartType.Pie" 
                InputData="@Data" @bind-SelectedIndex="Index" 
                InputLabels="@Labels" 
                Width="300px" 
                Height="300px" />
</MudPaper>

@code {
    [EditorRequired]
    [Parameter] public AporteRecetaLiquidaDto Aporte { get; set; } = default;
    [Parameter] public DateTime StartDate { get; set; }
    [Parameter] public DateTime EndDate { get; set; }
    double[] Data { get; set; } = new double[1];
    string[] Labels { get; set; } = new string[1];

    protected override async Task OnInitializedAsync()
    {
        await UpdateChartAsync();
    }
    public async Task UpdateChartAsync()
    {
        //var link = $"pizza?startDate={StartDate}&endDate={EndDate}&coUsuarios={string.Join(',', Aporte.Valores.Select(a => a.Name))}";
        //Aporte = await Http.GetFromJsonAsync<AporteRecetaLiquidaDto>(link) ;

        Data = new double[Aporte.Valores.Count];
        Labels = new string[Aporte.Valores.Count];
        var i = 0;
        Aporte.Valores.ForEach(a =>
        {
            Data[i] = a.RecetaLiquida;
            Labels[i] = $"{a.Name}, {a.Porciento}";
        });
    }

    private int Index = 0; //default value cannot be 0 -> first selectedindex is 0.
    int dataSize = 4;
}
